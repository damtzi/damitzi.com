---
import { Image } from 'astro:assets';
import VinylPng from '@/assets/black-vinyl.png';
import CdPng from '@/assets/clear-cd.png';
import BaseLayout from '@/layouts/base-layout.astro';
import Link from '@/components/shared/link.astro';
import RunCard from '@/components/run-card.astro';
import { slugify } from '@/lib/utils';
import { getStravaActivity } from '@/lib/strava';
import { getDiscogsCollection } from '@/lib/discogs';

const activities = await getStravaActivity();
const vinyls = await getDiscogsCollection();

// Sort by date_added in descending order (most recent first) and take the first 4
const recentVinyls = vinyls.releases
    .sort(
        (a, b) =>
            new Date(b.date_added).getTime() - new Date(a.date_added).getTime()
    )
    .slice(0, 4);
---

<BaseLayout title="Home">
    <div class="flex flex-col gap-8">
        <div class="flex flex-col gap-2">
            <h1 class="text-3xl font-serif font-medium">Welcome</h1>

            <p>
                Hello there! Welcome to my personal website. Here you can find: information <Link href="/about" title="about me" internal />,
                my <Link href="/projects" title="projects" internal />, my <Link href="/music/vinyls" title="vinyl collection" internal />,
                my <Link href="/music/top-picks" title="top picks" internal />, my <Link href="/socials" title="social links" internal />,
                my <Link href="/hobbies" title="hobbies" internal />, and my <Link href="/bread" title="bread" internal />.
            </p>
            <p>
                You can check out my work on <Link href="https://github.com/damtzi" title="GitHub" />, follow me on
                <Link href="https://bsky.app/profile/damitzi.com" title="Bluesky" />, <Link href="https://www.instagram.com/damitzi__" title="Instagram" />,
                <Link href="https://www.discogs.com/user/damitzi__" title="Discogs" />, <Link href="https://www.strava.com/athletes/108759547" title="Strava" />,
                or drop me an email at <Link href="mailto:damian.tziamtzis@gmail.com" title="damian.tziamtzis@gmail.com" />.
            </p>
        </div>

        <div class="flex flex-col gap-2">
            <h2 class="text-2xl font-serif font-medium">Recent runs</h2>
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                {
                    activities
                        .filter(activity => activity.type === 'Run')
                        .slice(0, 4)
                        .map(activity => (
                            <RunCard
                                date={activity.start_date_local}
                                distance={activity.distance}
                                movingTime={activity.moving_time}
                            />
                        ))
                }
            </div>
        </div>

        <div class="flex flex-col gap-2">
            <h2 class="text-2xl font-serif font-medium">Recent pickups</h2>
            <div class="grid grid-cols-2 sm:grid-cols-4 gap-4 md:gap-10">
                {
                    recentVinyls.map(release => (
                        <a
                            href={`/music/vinyls/${slugify(release.basic_information.title)}`}
                            class="relative group"
                        >
                            <Image
                                src={release.basic_information.cover_image}
                                alt={release.basic_information.title}
                                width={200}
                                height={200}
                                class="hover:scale-105 hover:cursor-pointer hover:shadow transition-all duration-300 rounded-xs shadow-lg relative z-10 aspect-square"
                                transition:name={`playlist ${release.id + '_a'} image`}
                            />
                            <Image
                                src={
                                    release.basic_information.formats
                                        .map(format => format.name)
                                        .find(name => name === 'Vinyl')
                                        ? VinylPng
                                        : CdPng
                                }
                                alt={
                                    release.basic_information.formats
                                        .map(format => format.name)
                                        .find(name => name === 'Vinyl')
                                        ? 'A black vinyl record'
                                        : 'A clear CD'
                                }
                                width={200}
                                height={200}
                                class="absolute top-0 group-hover:translate-x-10 transition-transform duration-300 z-0"
                            />
                        </a>
                    ))
                }
            </div>
        </div>
    </div>
</BaseLayout>
